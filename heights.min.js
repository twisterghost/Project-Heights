/**
 * Project Heights - heights.js
 * Minified version 1.0.4
 * https://github.com/twisterghost/Project-Heights
 */
 function getVersion(){return version}function step(){for(var e=0;e<objects.length;e++){try{objects[e].step();objects[e].drawObj()}catch(t){if(debugModeFlag){if(t.arguments[0]=="step"&&t.type=="undefined_method"||t.arguments[0]=="drawObj"&&t.type=="undefined_method"){}else{console.log(t)}}}}setTranslation();setViewScale();checkCollisions();getCanvas().drawLayers()}function start(){if(gameCanvas===null){gameCanvas=$("canvas")}viewWidth=getCanvas().width();viewHeight=getCanvas().height();viewWidthCurrent=viewWidth;viewHeightCurrent=viewHeight;runSteps();setUpListeners()}function deactivatePCS(){usingCollisionWorker=false}function runSteps(){if(running){clearInterval(runIntervalID)}runIntervalID=setInterval(step,1e3/fps);running=true}function pauseSteps(){clearInterval(runIntervalID)}function setUpListeners(){getCanvas().mousedown(handleInputs);getCanvas().mouseup(handleInputs);$(document).keydown(handleInputs);$(document).keyup(handleInputs)}function setFPS(e){fps=e;runSteps()}function setCanvas(e){gameCanvas=e}function getCanvas(){return gameCanvas}function instanceArrayPosition(e){for(var t=0;t<objects.length;t++){if(objects[t]==e){return t}}return-1}function handleInputs(e){if(e.originalEvent.type=="keydown"){keyStatus[getKeyPressed(e)]=true}else if(e.originalEvent.type=="keyup"){keyStatus[getKeyPressed(e)]=false}for(var t=0;t<inputObjects.length;t++){inputObjects[t].handleInput(e)}}function inputHook(e){inputObjects.push(e)}function inputUnhook(e){for(var t=0;t<inputObjects.length;t++){if(inputObjects[t]==e){inputObjects.splice(t,1)}}}function setTranslation(){var e=viewX-viewXCurrent;var t=viewY-viewYCurrent;viewXCurrent=viewX;viewYCurrent=viewY;getCanvas().translateCanvas({translateX:-e,translateY:-t})}function setViewScale(){var e=viewWidthCurrent/viewWidth;var t=viewHeightCurrent/viewHeight;viewHeightCurrent=viewHeight;viewWidthCurrent=viewWidth;getCanvas().scaleCanvas({scaleX:e,scaleY:t,x:viewX,y:viewY})}function debugMode(e){debugModeFlag=e}function collideable(e){if(collisionWorker==null&&usingCollisionWorker){collisionWorker=new Worker(workerPath+"/heights-collisions.js")}collideableObjs.push(e)}function checkCollisions(){if(this.collisionWorker!=null){collisionWorker.postMessage(JSON.stringify(collideableObjs));collisionWorker.onmessage=function(e){var t=JSON.parse(e.data);var n=getInstanceByID(t[0]);var r=getInstanceByID(t[1]);try{n.onCollision(r)}catch(i){}}}}function resource(e){document.write("<script type='text/javascript' src='"+e+"'>"+"</script>")}function varDefault(e,t){return typeof e!=="undefined"?e:t}function getUniqueID(){return instanceID++}function convertProperty(e,t,n){if(e.hasOwnProperty(t)){e[n]=e[t];delete e[t]}return e}function createInstance(e,t,n,r){r=varDefault(r,0);var i=new n(e,t,instanceID,r);instanceID++;objects.push(i);return i}function destroyInstance(e){var t=instanceArrayPosition(e);var n=objects.splice(t,1);if(collideableObjs.indexOf(e)!=-1){collideableObjs.splice(collideableObjs.indexOf(e),1)}if(inputObjects.indexOf(e)!=-1){inputObjects.splice(inputObjects.indexOf(e),1)}try{n[0].destroy()}catch(r){}delete e}function getInstanceByID(e){for(var t=0;t<objects.length;t++){if(objects[t].id==e){return objects[t]}}return null}function collisionInstance(e,t){return e.x<t.x+t.width&&e.x+e.width>t.x&&e.y<t.y+t.height&&e.y+e.height>t.y}function collisionObject(e,t){var n=getObjectsOfType(t);for(var r=0;r<n.length;r++){if(n[r]!=e){if(collisionInstance(e,n[r])){return n[r]}}}return null}function collisionPoint(e,t,n){return t>=e.x&&t<=e.x+e.width&&n>=e.y&&n<=e.y+e.height}function getObjectsOfType(e){var t=[];for(var n=0;n<objects.length;n++){if(objects[n]instanceof e){t.push(objects[n])}}return t}function instanceExists(e){for(var t=0;t<objects.length;t++){if(objects[t]instanceof e){return objects[t]}}return false}function instanceDistance(e,t){return Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2))}function getKeyCode(e){return e.keyCode}function getClickX(e){return e.offsetX+viewX}function getClickY(e){return e.offsetY+viewY}function getClickedOn(e,t){var n=getClickX(t);var r=getClickY(t);return n>=e.x&&n<=e.x+e.width&&r>=e.y&&r<=e.y+e.height}function getInputType(e){return e.type}function getKeyPressed(e){var t=String.fromCharCode(e.keyCode);if(charNames.hasOwnProperty(t)){t=charNames[t]}if(charNames.hasOwnProperty(e.keyCode.toString())){t=charNames[e.keyCode.toString()]}return t}function keyDown(e){e=e.toUpperCase();if(keyStatus.hasOwnProperty(e)){return keyStatus[e]}return false}function boundInstance(e,t,n,r,i){if(e.x>r){e.x=r}if(e.x<t){e.x=t}if(e.y>i){e.y=i}if(e.y<n){e.y=n}}function chance(e){var t=Math.floor(Math.random()*100)+1;return t<=e}var objects=[];var collideableObjs=[];var instanceID=0;var fps=60;var running=false;var runIntervalID=-1;var gameCanvas=null;var inputObjects=[];var sounds=[];var debugModeFlag=false;var usingCollisionWorker=true;var collisionWorker=null;var version="1.0.4";var viewX=0;var viewY=0;var viewXCurrent=0;var viewYCurrent=0;var viewWidth=0;var viewHeight=0;var viewWidthCurrent=0;var viewHeightCurrent=0;var mouseX=-1;var mouseY=-1;var charNames={"&":"UP","(":"DOWN","%":"LEFT","'":"RIGHT"," ":"SPACE",17:"CTRL",18:"ALT",16:"SHIFT",20:"CAPS",9:"TAB",13:"ENTER"};var keyStatus={};var workerPath="/workers";var Sound=function(e){this.mimeType="";var t='<audio><source src="'+e+'" type="'+this.mimeType+'"></audio>';this.audioElement=$(t);$("body").append(this.audioElement);this.audioElement[0].load();sounds.push(this)};Sound.prototype.play=function(){this.audioElement[0].play()};Sound.prototype.pause=function(){this.audioElement[0].pause()};Sound.prototype.loop=function(){this.audioElement[0].loop=true;this.audioElement[0].play()};Sound.prototype.reset=function(){this.audioElement[0].currentTime=0};Sound.prototype.stop=function(){this.audioElement[0].pause();this.audioElement[0].currentTime=0};Sound.prototype.unload=function(){this.audioElement.remove()};Sound.prototype.getTime=function(){return this.audioElement[0].currentTime};Sound.prototype.getProperty=function(e){return this.audioElement[0][e]};Sound.prototype.setProperty=function(e,t){this.audioElement[0][e]=t};var Draw=function(){this.id=getUniqueID();this.type=Draw.DRAW};Draw.prototype.DRAW=0;Draw.prototype.CIRCLE=1;Draw.prototype.SPRITE=2;Draw.prototype.SPRITESHEET=3;Draw.prototype.RECTANGLE=4;Draw.prototype.LINE=5;Draw.prototype.TEXT=6;Draw.prototype.POLYGON=7;Draw.prototype.circle=function(e){e.x=varDefault(e.x,0);e.y=varDefault(e.y,0);e.rad=varDefault(e.rad,0);e.color=varDefault(e.color,"#000");e.width=varDefault(e.width,1);e.centered=varDefault(e.centered,true);e.updateable=varDefault(e.updateable,true);e.filled=varDefault(e.filled,false);e.layer=true;e.name=this.id.toString();e=this.normalizeDrawParams(e);this.type=Draw.CIRCLE;getCanvas().drawArc(e);return this};Draw.prototype.sprite=function(e){e.x=varDefault(e.x,0);e.y=varDefault(e.y,0);e.url=varDefault(e.url,"");e.centered=varDefault(e.centered,false);e.rotate=varDefault(e.rotate,0);e=this.normalizeDrawParams(e);e.layer=true;e.name=this.id.toString();this.type=Draw.SPRITE;getCanvas().drawImage(e);return this};Draw.prototype.spriteSheet=function(e){e.x=varDefault(e.x,0);e.y=varDefault(e.y,0);e.cropX=varDefault(e.cropX,0);e.cropY=varDefault(e.cropY,0);e.cropWidth=varDefault(e.cropWidth,32);e.cropHeight=varDefault(e.cropHeight,32);e.url=varDefault(e.url,"");e.centered=varDefault(e.centered,false);e.updateable=varDefault(e.updateable,true);e.cropFromCenter=false;this.spriteWidth=e.cropWidth;this.spriteHeight=e.cropHeight;this.spritesPerRow=varDefault(e.spritesPerRow,1);this.totalSprites=varDefault(e.totalSprites,1);this.spriteIndex=varDefault(e.spriteIndex,0);e=this.normalizeDrawParams(e);e.layer=true;e.name=this.id.toString();this.type=Draw.SPRITESHEET;getCanvas().drawImage(e);return this};Draw.prototype.cropToCurrentSprite=function(){var e=Math.floor(this.spriteIndex/this.spritesPerRow)*this.spriteWidth;var t=this.spriteIndex%this.spritesPerRow*this.spriteHeight;this.update({cropX:e,cropY:t})};Draw.prototype.nextSprite=function(){if(this.type==Draw.SPRITESHEET){this.spriteIndex=(this.spriteIndex+1)%this.totalSprites;this.cropToCurrentSprite()}};Draw.prototype.gotoSprite=function(e){if(this.type==Draw.SPRITESHEET){this.spriteIndex=e%this.totalSprites}};Draw.prototype.rectangle=function(e){e.x=varDefault(e.x,0);e.y=varDefault(e.y,0);e.width=varDefault(e.width,0);e.height=varDefault(e.height,0);e.filled=varDefault(e.filled,false);e.color=varDefault(e.color,"#000");e.type=Draw.RECTANGLE;e.lineWidth=varDefault(e.lineWidth,1);e.centered=varDefault(e.centered,false);e=this.normalizeDrawParams(e);e.layer=true;e.name=this.id.toString();this.type=Draw.RECTANGLE;getCanvas().drawRect(e);return this};Draw.prototype.polygon=function(e){e.x=varDefault(e.x,0);e.y=varDefault(e.y,0);e.width=varDefault(e.width,0);e.height=varDefault(e.height,0);e.filled=varDefault(e.filled,false);e.color=varDefault(e.color,"#000");e.type=Draw.POLYGON;e.lineWidth=varDefault(e.lineWidth,1);e.sides=varDefault(e.sides,3);e.centered=varDefault(e.centered,true);e.radius=varDefault(e.radius,10);e.projection=varDefault(e.projection,.5);e=this.normalizeDrawParams(e);this.type=Draw.POLYGON;e.layer=true;e.name=this.id.toString();getCanvas().drawPolygon(e);return this};Draw.prototype.text=function(e){e.x=varDefault(e.x,0);e.y=varDefault(e.y,0);e.centered=varDefault(e.centered,false);e.text=varDefault(e.text,"");e.font=varDefault(e.font,"12pt Helvetica");e.color=varDefault(e.color,"#000");e.filled=varDefault(e.filled,true);e=this.normalizeDrawParams(e);this.type=Draw.TEXT;e.layer=true;e.name=this.id.toString();getCanvas().drawText(e);return this};Draw.prototype.update=function(e){e=this.normalizeDrawParams(e);getCanvas().setLayer(this.id.toString(),e)};Draw.prototype.undraw=function(){getCanvas().removeLayer(this.id.toString())};Draw.prototype.normalizeDrawParams=function(e){if(e.filled){e=convertProperty(e,"color","fillStyle")}e=convertProperty(e,"cropX","sx");e=convertProperty(e,"cropY","sx");e=convertProperty(e,"cropWidth","sWidth");e=convertProperty(e,"cropHeight","sHeight");e=convertProperty(e,"url","source");e=convertProperty(e,"centered","fromCenter");e=convertProperty(e,"color","strokeStyle");e=convertProperty(e,"lineWidth","strokeWidth");return e}