/*
 jCanvas v13.04.26
 Copyright 2013 Caleb Evans
 Released under the MIT license
*/
(function(k,Q,X,F,Y,m,r,l,p){function n(d){A(this,d);return this}function w(d){d?A(n.prototype,d):w.prefs=n.prototype=A({},M);return this}function H(d){return"string"===typeof d}function I(d){return"function"===typeof d}function q(d){return d&&d.getContext?d.getContext("2d"):l}function y(d,a){d.fillStyle=a.fillStyle;d.strokeStyle=a.strokeStyle;d.lineWidth=a.strokeWidth;a.rounded?(d.lineCap="round",d.lineJoin="round"):(d.lineCap=a.strokeCap,d.lineJoin=a.strokeJoin,d.miterLimit=a.miterLimit);d.shadowOffsetX=
a.shadowX;d.shadowOffsetY=a.shadowY;d.shadowBlur=a.shadowBlur;d.shadowColor=a.shadowColor;d.globalAlpha=a.opacity;d.globalCompositeOperation=a.compositing;a.imageSmoothing&&(d.webkitimageSmoothingEnabled=d.mozimageSmoothingEnabled=a.imageSmoothing)}function Z(d,a,b){b.mask&&(b.autosave&&(d.save(),a.savedTransforms=A({},a.transforms),a.transforms.masks+=1,a.transforms.withinMask=d.isPointInPath(a.event.x,a.event.y)?m:r),d.clip())}function R(d,a,b){b.layer&&(b._args.withinMask=a.transforms.withinMask===
m||a.transforms.withinMask===l?m:r)}function B(d,a,b){b.closed&&a.closePath();a.fill();"transparent"!==b.fillStyle&&(a.shadowColor="transparent");0!==b.strokeWidth&&a.stroke();b.closed||a.closePath();b._transformed&&a.restore();if(b.mask||b.layer)d=s(d),Z(a,d,b),R(a,d,b)}function $(d,a,b){a._toRad=a.inDegrees?u/180:1;d.translate(a.x,a.y);d.rotate(a.rotate*a._toRad);d.translate(-a.x,-a.y);b.rotate+=a.rotate*a._toRad}function aa(d,a,b){1!==a.scale&&(a.scaleX=a.scaleY=a.scale);d.translate(a.x,a.y);d.scale(a.scaleX,
a.scaleY);d.translate(-a.x,-a.y);b.scaleX*=a.scaleX;b.scaleY*=a.scaleY}function ba(d,a,b){a.translate&&(a.translateX=a.translateY=a.translate);d.translate(a.translateX,a.translateY);b.translateX+=a.translateX;b.translateY+=a.translateY}function x(d,a,b,c){a._toRad=a.inDegrees?u/180:1;a._transformed=m;d.save();c===p&&(c=b);!a.fromCenter&&!a._centered&&(a.x+=b/2,a.y+=c/2,a._centered=m);a.rotate&&$(d,a,{});(1!==a.scale||1!==a.scaleX||1!==a.scaleY)&&aa(d,a,{});(a.translate||a.translateX||a.translateY)&&
ba(d,a,{})}function s(d){var a;t._canvas===d&&t._data?a=t._data:(a=k.data(d,"jCanvas"),a||(a={canvas:d,layers:[],layer:{names:{},groups:{}},intersects:[],drag:{},event:{},events:{},transforms:{rotate:0,scaleX:1,scaleY:1,translateX:0,translateY:0,masks:0,withinMask:l},animating:r,animated:l},a.savedTransforms=A({},a.transforms),k.data(d,"jCanvas",a)),t._canvas=d,t._data=a);return a}function ca(d,a,b){for(var c in w.events)if(w.events.hasOwnProperty(c)){var e=d,f=a,h=b,g=c;h[g]&&(g=S(g),w.events[g](e,
f),h._event=m)}}function da(d,a,b){var c,e,f;if(b.draggable||b.dragGroupWithLayer||b.cursor){c=["mousedown","mousemove","mouseup"];for(f=0;f<c.length;f+=1)e=S(c[f]),w.events[e](d,a);a.events.mouseoutdrag||(d.bind("mouseout.jCanvas",function(){var b=a.drag.layer;b&&(a.drag={},d.drawLayers(),b.dragcancel&&b.dragcancel.call(d[0],b))}),a.events.mouseoutdrag=m);b._event=m}}function N(d,a,b,c){d=a.layer.names;c?c.name!==p&&(H(b.name)&&b.group!==c.group)&&delete d[b.name]:c=b;H(c.name)&&(d[c.name]=b)}function T(d,
a,b,c){d=a.layer.groups;var e,f;if(c){if(c.group!==p&&(H(b.group)&&b.group!==c.group)&&(a=d[b.group])){for(f=0;f<a.length;f+=1)if(a[f]===b){e=f;a.splice(f,1);break}0===a.length&&delete d[b.group]}}else c=b;H(c.group)&&(a=d[c.group],a||(a=d[c.group]=[],a.name=c.group),e===p&&(e=a.length),a.splice(e,0,b))}function v(d,a,b,c){var e,f={};a._args=b;a.canvas=d;if(a.draggable||f.group)a.layer=m,a.draggable=m;a.layer&&!a._layer&&(b=k(d),e=b.getLayers(),a._method=c?k.fn[c]:a.method?k.fn[a.method]:a.type?k.fn[ea[a.type]]:
function(){},d=s(d),f=new n(a),N(b,d,f),T(b,d,f),ca(b,d,f),da(b,d,f),f.layer=m,f._layer=m,f.index===p&&(f.index=e.length),e.splice(f.index,0,f));return f}function fa(d){var a;for(a=0;a<D.length;a+=1)d[D[a]]=d["_"+D[a]]}function ga(d,a){var b;for(b=0;b<D.length;b+=1)d["_"+D[b]]=d[D[b]],U[D[b]]=1,a&&delete d[D[b]]}function ha(d){var a,b,c=[],e=1;d.match(/^#?\w+$/i)&&("transparent"===d&&(d="rgba(0,0,0,0)"),b=Q.head,a=b.style.color,b.style.color=d,d=k.css(b,"color"),b.style.color=a);d.match(/^rgb/i)&&
(c=d.match(/\d+/gi),d.match(/%/gi)&&(e=2.55),c[0]*=e,c[1]*=e,c[2]*=e,c[3]=c[3]!==p?Y(c[3]):1);return c}function ma(d){var a=3,b;"object"!==typeof d.start&&(d.start=ha(d.start),d.end=ha(d.end));d.now=[];if(1!==d.start[3]||1!==d.end[3])a=4;for(b=0;b<a;b+=1)d.now[b]=d.start[b]+(d.end[b]-d.start[b])*d.pos,3>b&&(d.now[b]=na(d.now[b]));1!==d.start[3]||1!==d.end[3]?d.now="rgba("+d.now.join(",")+")":(d.now.slice(0,3),d.now="rgb("+d.now.join(",")+")");d.elem.nodeName?d.elem.style[d.prop]=d.now:d.elem[d.prop]=
d.now}function S(d){"ontouchstart"in window&&V[d]&&(d=V[d]);return d}function C(d){w.events[d]=function(a,b){d=S(d);var c="mouseover"===d||"mouseout"===d?"mousemove":d,e=b.event;b.events[c]||(a.bind(c+".jCanvas",function(b){e.x=b.offsetX;e.y=b.offsetY;e.type=c;e.event=b;a.drawLayers({resetFire:m});b.preventDefault()}),b.events[c]=m)}}function z(d,a,b){var c,e,f,h;b=b._args;b._event&&(d=s(d),c=d.event,a=a.isPointInPath(c.x,c.y),e=d.transforms,b.eventX=b.mouseX=c.x,b.eventY=b.mouseY=c.y,b.event=c.event,
h=d.transforms.rotate,c=b.eventX,f=b.eventY,0!==h?(b._eventX=c*G(-h)-f*J(-h),b._eventY=f*G(-h)+c*J(-h)):(b._eventX=c,b._eventY=f),b._eventX/=e.scaleX,b._eventY/=e.scaleY,!a&&(b._hovered&&!b._fired)&&(b._mousedout=m),a&&d.intersects.push(b))}function O(d,a,b,c,e){a.save();a.beginPath();a.rect(c[0],e[0],c[1]-c[0],e[1]-e[0]);a.clip();x(a,b,0);a.beginPath()}function P(d,a,b){b._event&&z(d,a,b);a.restore();B(d,a,b)}function ia(d,a){a.font?d.font=a.font:(isNaN(Number(a.fontSize))||(a.fontSize+="px"),d.font=
a.fontStyle+" "+a.fontSize+" "+a.fontFamily)}function ja(d,a,b,c){var e,f=/\b(\d*\.?\d*)\w\w\b/gi,h;if(t.text===b.text&&t.font===b.font&&t.fontStyle===b.fontStyle&&t.fontSize===b.fontSize&&t.fontFamily===b.fontFamily&&t.maxWidth===b.maxWidth&&t.lineHeight===b.lineHeight)b.width=t.width,b.height=t.height;else{b.width=a.measureText(c[0]).width;for(e=1;e<c.length;e+=1)h=a.measureText(c[e]).width,h>b.width&&(b.width=h);a=d.style.fontSize;if(b.font){if(e=b.font.match(f))d.style.fontSize=b.font.match(f)[0]}else d.style.fontSize=
b.fontSize;b.height=Y(k.css(d,"fontSize"))*c.length*b.lineHeight;d.style.fontSize=a}}function ka(d,a){var b=a.text,c=a.maxWidth,e=b.split(" "),f=[],h="";if(d.measureText(b).width<c||1===e.length)f=[b];else{for(b=0;b<e.length;b+=1)d.measureText(h+e[b]).width>c&&(""!==h&&f.push(h),h=""),h+=e[b],b!==e.length-1&&(h+=" ");f.push(h)}return f=f.join("\n").replace(/( (\n))|( $)/gi,"$2").split("\n")}var M,A=k.extend,K=k.inArray,na=F.round,u=F.PI,J=F.sin,G=F.cos,oa=k.event.fix,V,W,ea,t={},D,U;k.fn.jCanvas=
w;w.events={};M={align:"center",autosave:m,baseline:"middle",bringToFront:r,ccw:r,closed:r,compositing:"source-over",concavity:0,cornerRadius:0,cropFromCenter:m,disableDrag:r,disableEvents:r,domain:l,draggable:r,group:null,data:{},each:l,end:360,fillStyle:"transparent",font:"",fontStyle:"normal",fontSize:"12pt",fontFamily:"sans-serif",fromCenter:m,fn:l,graph:"y",height:l,imageSmoothing:m,inDegrees:m,lineHeight:1,layer:!1,load:l,mask:r,maxWidth:l,miterLimit:10,name:null,opacity:1,projection:0,r1:l,
r2:l,radius:0,range:l,repeat:"repeat",rotate:0,rounded:r,scale:1,scaleX:1,scaleY:1,shadowBlur:0,shadowColor:"transparent",shadowX:0,shadowY:0,sHeight:l,sides:0,source:"",start:0,strokeCap:"butt",strokeJoin:"miter",strokeStyle:"transparent",strokeWidth:1,sWidth:l,sx:l,sy:l,text:"",translate:0,translateX:0,translateY:0,type:l,visible:m,width:l,x:0,y:0};w();w.extend=function(d){w.defaults=A(M,d.props);w();d.name&&(k.fn[d.name]=function(a){var b,c,e,f=new n(a);for(c=0;c<this.length;c+=1)if(b=this[c],
e=q(b))a=v(b,f,a,d.name),y(e,f),d.fn.call(b,e,f);return this});return k.fn[d.name]};k.fn.getLayers=function(d){var a=this[0],b,c,e=[];if(a&&a.getContext)if(b=s(a).layers,I(d))for(c=0;c<b.length;c+=1)d.call(a,b[c])&&e.push(b[c]);else e=b;return e};k.fn.getLayer=function(d){var a=this.getLayers(),b=k.type(d),c=s(this[0]),e;if(d&&d.layer)e=d;else if("number"===b)0>d&&(d=a.length+d),e=a[d];else if("regexp"===b)for(b=0;b<a.length;b+=1){if(H(a[b].name)&&a[b].name.match(d)){e=a[b];break}}else c=s(this[0]),
e=c.layer.names[d];return e};k.fn.getLayerGroup=function(d){var a=k.type(d),b,c;if("array"===a)return d;if("regexp"===a)for(b in a=s(this[0]),a=a.groups,a){if(b.match(d)){c=a[b];break}}else a=s(this[0]),c=a.layer.groups[d];return c};k.fn.getLayerIndex=function(d){var a=this.getLayers();d=this.getLayer(d);return K(d,a)};k.fn.setLayer=function(d,a){var b,c,e,f;for(c=0;c<this.length;c+=1)if(b=k(this[c]),e=s(this[c]),f=k(this[c]).getLayer(d))N(b,e,f,a),T(b,e,f,a),A(f,a),ca(b,e,f),da(b,e,f);return this};
k.fn.setLayerGroup=function(d,a){var b,c,e,f;for(c=0;c<this.length;c+=1)if(b=k(this[c]),e=b.getLayerGroup(d))for(f=0;f<e.length;f+=1)b.setLayer(e[f],a);return this};k.fn.setLayers=function(d){var a,b,c,e;for(b=0;b<this.length;b+=1){a=k(this[b]);c=k(this[b]).getLayers();for(e=0;e<c.length;e+=1)a.setLayer(c[e],d)}return this};k.fn.moveLayer=function(d,a){var b,c,e;for(c=0;c<this.length;c+=1)if(b=k(this[c]),e=b.getLayers(),b=b.getLayer(d))b.index=K(b,e),e.splice(b.index,1),e.splice(a,0,b),0>a&&(a=e.length+
a),b.index=a;return this};k.fn.removeLayer=function(d){var a,b,c,e,f;for(b=0;b<this.length;b+=1)if(a=k(this[b]),c=s(this[b]),e=a.getLayers(),f=a.getLayer(d))f.index=K(f,e),e.splice(f.index,1),N(a,c,f,{name:null}),T(a,c,f,{group:null});return this};k.fn.removeLayerGroup=function(d){var a,b,c;k.type(d);var e,f,h,g;if(d!==p)for(b=0;b<this.length;b+=1)if(a=k(this[b]),c=s(this[b]),e=a.getLayers(),f=a.getLayerGroup(d)){for(g=0;g<f.length;g+=1)h=f[g],h.index=K(h,e),e.splice(h.index,1),N(a,c,h,{name:null});
delete c.layer.groups[f.name]}return this};k.fn.removeLayers=function(){var d,a;for(a=0;a<this.length;a+=1)d=k(this[a]),d=d.getLayers(),d.length=0;return this};k.fn.drawLayer=function(d){var a,b,c;for(a=0;a<this.length;a+=1)if(b=k(this[a]),q(this[a]),(c=b.getLayer(d))&&c.visible&&c._method)c._next=null,c._method.call(b,c);return this};k.fn.drawLayers=function(d){var a,b,c=d||{},e,f,h,g,j,E;c.index||(c.index=0);for(d=0;d<this.length;d+=1)if(a=k(this[d]),b=q(this[d])){h=s(this[d]);for(e=0;e<h.transforms.masks;e+=
1)a.restoreCanvas();c.clear!==r&&a.clearCanvas();b=h.layers;for(f=c.index;f<b.length&&!(e=b[f],e.index=f,c.resetFire&&(e._fired=r),e._event=!e.disableEvents,g=a,j=e,E=f+1,j&&(j.visible&&j._method)&&(j._next=E?E:null,j._method.call(g,j)),e._mousedout&&(e._mousedout=r,e._fired=m,e._hovered=r,e.mouseout&&e.mouseout.call(this[d],e),e.cursor&&e._cursor&&a.css({cursor:e._cursor})),e._method===k.fn.drawImage&&e.visible);f+=1);for(e=0;e<h.transforms.masks;e+=1)a.restoreCanvas();e=h.intersects[h.intersects.length-
1]||{};f=h.event;g=f.type;e[g]||W[g]&&(g=W[g]);E=e[g];j=h.drag;if(e._event&&e.withinMask===m){if((e.mouseover||e.mouseout||e.cursor)&&!e._hovered&&!e._fired)e._fired=m,e._hovered=m,e.mouseover&&e.mouseover.call(this[d],e),e.cursor&&(e._cursor=a.css("cursor"),a.css({cursor:e.cursor}));E&&!e._fired&&(e._fired=m,E.call(this[d],e),f.type=l);if(e.draggable&&!e.disableDrag&&("mousedown"===g||"touchstart"===g)){e.bringToFront&&(b.splice(e.index,1),e.index=b.push(e));j.layer=e;j.dragging=m;if(j.layer.group&&
j.layer.dragGroupWithLayer&&(a=h.layer.groups[j.layer.group]))for(f=0;f<a.length;f+=1)a[f]!==j.layer&&(a[f]._startX=a[f].x,a[f]._startY=a[f].y,a[f]._endX=e._eventX,a[f]._endY=e._eventY,a[f].bringToFront&&(a[f].index=K(a[f],b),b.splice(a[f].index,1),b.splice(-1,0,a[f]),a[f].index=b.length-2));j._startX=e._startX=e.x;j._startY=e._startY=e.y;j._endX=e._endX=e._eventX;j._endY=e._endY=e._eventY;e.dragstart&&e.dragstart.call(this[d],e)}}if(j.layer){if(j.dragging&&("mouseup"===g||"touchend"===g))j.layer.dragstop&&
j.layer.dragstop.call(this[d],j.layer),h.drag={};if(j.dragging&&("mousemove"===g||"touchmove"===g))if(j.layer.x=j.layer._eventX-(j._endX-j._startX),j.layer.y=j.layer._eventY-(j._endY-j._startY),j.layer.drag&&j.layer.drag.call(this[d],j.layer),j.layer.group&&j.layer.dragGroupWithLayer&&(a=h.layer.groups[j.layer.group]))for(f=0;f<a.length;f+=1)a[f]!==j.layer&&(a[f].x=j.layer._eventX-(a[f]._endX-a[f]._startX),a[f].y=j.layer._eventY-(a[f]._endY-a[f]._startY))}h.intersects=[]}return this};k.fn.addLayer=
function(d){var a,b,c;c=new n(d);for(a=0;a<this.length;a+=1)if(b=q(this[a]))c.layer=m,d=v(this[a],c,d);return this};D=["width","height","opacity","lineHeight"];U={};k.fn.animateLayer=function(){function d(a,b,c){return function(){fa(c);(!b.animating||b.animated===c)&&a.drawLayers();f[4]&&f[4].call(a[0],c);c._animating=r;b.animating=r;b.animated=l}}function a(a,b,c){return function(d,e){fa(c);!c._animating&&!b.animating&&(c._animating=m,b.animating=m,b.animated=c);(!b.animating||b.animated===c)&&a.drawLayers();
f[5]&&f[5].call(a[0],d,e,c)}}var b,c,e,f=[].slice.call(arguments,0),h,g;"object"===typeof f[0]&&!f[0].layer&&f.unshift(0);"object"===typeof f[2]?(f.splice(2,0,f[2].duration||l),f.splice(3,0,f[3].easing||l),f.splice(4,0,f[4].complete||l),f.splice(5,0,f[5].step||l)):(f[2]===p?(f.splice(2,0,l),f.splice(3,0,l),f.splice(4,0,l)):I(f[2])&&(f.splice(2,0,l),f.splice(3,0,l)),f[3]===p?(f[3]=l,f.splice(4,0,l)):I(f[3])&&f.splice(3,0,l));for(c=0;c<this.length;c+=1)if(b=k(this[c]),e=q(this[c]))if(e=s(this[c]),(h=
b.getLayer(f[0]))&&h._method!==k.fn.draw){g=A({},f[1]);var j=this[c],E=h,n=void 0;for(n in g)g.hasOwnProperty(n)&&I(g[n])&&(g[n]=g[n].call(j,E,n));ga(g,m);ga(h);h.style=U;k(h).animate(g,{duration:f[2],easing:k.easing[f[3]]?f[3]:l,complete:d(b,e,h),step:a(b,e,h)})}return this};k.fn.animateLayerGroup=function(d){var a,b,c=[].slice.call(arguments,0),e,f;for(b=0;b<this.length;b+=1){a=k(this[b]);e=a.getLayerGroup(d);for(f=0;f<e.length;f+=1)a.animateLayer.apply(a,[e[f]].concat(c.slice(1)))}return this};
k.fn.delayLayer=function(d,a){var b,c;a=a||0;for(b=0;b<this.length;b+=1)c=k(this[b]).getLayer(d),k(c).delay(a);return this};k.fn.delayLayerGroup=function(d,a){var b,c,e,f;a=a||0;for(c=0;c<this.length;c+=1)if(b=k(this[c]),b=b.getLayerGroup(d))for(f=0;f<b.length;f+=1)(e=b[f])&&k(e).delay(a);return this};k.fn.stopLayer=function(d,a){var b,c;for(b=0;b<this.length;b+=1)(c=k(this[b]).getLayer(d))&&k(c).stop(a);return this};k.fn.stopLayerGroup=function(d,a){var b,c,e,f;for(c=0;c<this.length;c+=1)if(b=k(this[c]),
b=b.getLayerGroup(d))for(f=0;f<b.length;f+=1)(e=b[f])&&k(e).stop(a);return this};var la="color backgroundColor borderColor borderTopColor borderRightColor borderBottomColor borderLeftColor fillStyle outlineColor strokeStyle shadowColor".split(" "),L;for(L=0;L<la.length;L+=1)k.fx.step[la[L]]=ma;V={mousedown:"touchstart",mouseup:"touchend",mousemove:"touchmove"};W={touchstart:"mousedown",touchend:"mouseup",touchmove:"mousemove"};C("click");C("dblclick");C("mousedown");C("mouseup");C("mousemove");C("mouseover");
C("mouseout");C("touchstart");C("touchmove");C("touchend");k.event.fix=function(d){var a,b;d=oa.call(k.event,d);if(a=d.originalEvent)if(b=a.changedTouches,d.pageX!==p&&d.offsetX===p){if(a=k(d.target).offset())d.offsetX=d.pageX-a.left,d.offsetY=d.pageY-a.top}else if(b&&(a=k(a.target).offset()))d.offsetX=b[0].pageX-a.left,d.offsetY=b[0].pageY-a.top;return d};ea={arc:"drawArc",bezier:"drawBezier",circle:"drawArc",ellipse:"drawEllipse","function":"draw",image:"drawImage",line:"drawLine",polygon:"drawPolygon",
quadratic:"drawQuadratic",rectangle:"drawRect",text:"drawText",vector:"drawVector"};k.fn.draw=function(d){var a,b,c;c=new n(d);for(a=0;a<this.length;a+=1)if((b=q(this[a]))&&c.fn)d=v(this[a],c,d,"draw"),c.visible&&c.fn.call(this[a],b,c);return this};k.fn.clearCanvas=function(d){var a,b=new n(d);for(d=0;d<this.length;d+=1)if(a=q(this[d]))!b.x||!b.y||!b.width||!b.height?(a.save(),a.setTransform(1,0,0,1,0,0),a.clearRect(0,0,this[d].width,this[d].height)):(x(a,b,b.width,b.height),a.clearRect(b.x-b.width/
2,b.y-b.height/2,b.width,b.height)),a.restore();return this};k.fn.saveCanvas=function(){var d,a,b;for(d=0;d<this.length;d+=1)if(a=q(this[d]))b=s(this[d]),a.save(),b.savedTransforms=A({},b.transforms);return this};k.fn.restoreCanvas=function(){var d,a,b;for(d=0;d<this.length;d+=1)if(a=q(this[d]))b=s(this[d]),a.restore(),b.transforms=A({},b.savedTransforms);return this};k.fn.restoreCanvasOnRedraw=function(d){var a={layer:m,fn:function(){k(this).restoreCanvas()}};A(a,d);return this.draw(a)};k.fn.translateCanvas=
function(d){var a,b,c=new n(d),e;for(a=0;a<this.length;a+=1)if(b=q(this[a]))e=s(this[a]),d=v(this[a],c,d,"translateCanvas"),c.autosave&&b.save(),ba(b,c,e.transforms);return this};k.fn.scaleCanvas=function(d){var a,b,c=new n(d),e;for(a=0;a<this.length;a+=1)if(b=q(this[a]))e=s(this[a]),d=v(this[a],c,d,"scaleCanvas"),c.autosave&&b.save(),aa(b,c,e.transforms);return this};k.fn.rotateCanvas=function(d){var a,b,c=new n(d),e;for(a=0;a<this.length;a+=1)if(b=q(this[a]))e=s(this[a]),d=v(this[a],c,d,"rotateCanvas"),
c.autosave&&b.save(),$(b,c,e.transforms);return this};k.fn.drawRect=function(d){var a,b,c=new n(d),e,f,h,g,j;for(a=0;a<this.length;a+=1)if(b=q(this[a]))d=v(this[a],c,d,"drawRect"),c.visible&&(y(b,c),x(b,c,c.width,c.height),b.beginPath(),e=c.x-c.width/2,f=c.y-c.height/2,(j=c.cornerRadius)?(c.closed=m,h=c.x+c.width/2,g=c.y+c.height/2,0>h-e-2*j&&(j=(h-e)/2),0>g-f-2*j&&(j=(g-f)/2),b.moveTo(e+j,f),b.lineTo(h-j,f),b.arc(h-j,f+j,j,3*u/2,2*u,r),b.lineTo(h,g-j),b.arc(h-j,g-j,j,0,u/2,r),b.lineTo(e+j,g),b.arc(e+
j,g-j,j,u/2,u,r),b.lineTo(e,f+j),b.arc(e+j,f+j,j,u,3*u/2,r)):b.rect(e,f,c.width,c.height),c._event&&z(this[a],b,c),B(this[a],b,c));return this};k.fn.drawArc=function(d){var a,b,c=new n(d);d=d||{};c.layer&&(!c.inDegrees&&360===c.end)&&(d.end=c.end=2*u);for(a=0;a<this.length;a+=1)if(b=q(this[a]))d=v(this[a],c,d,"drawArc"),c.visible&&(y(b,c),x(b,c,2*c.radius),b.beginPath(),b.arc(c.x,c.y,c.radius,c.start*c._toRad-u/2,c.end*c._toRad-u/2,c.ccw),c._event&&z(this[a],b,c),B(this[a],b,c));return this};k.fn.drawEllipse=
function(d){var a,b,c=new n(d),e=4*c.width/3,f=c.height;c.closed=m;for(a=0;a<this.length;a+=1)if(b=q(this[a]))d=v(this[a],c,d,"drawEllipse"),c.visible&&(y(b,c),x(b,c,c.width,c.height),b.beginPath(),b.moveTo(c.x,c.y-f/2),b.bezierCurveTo(c.x-e/2,c.y-f/2,c.x-e/2,c.y+f/2,c.x,c.y+f/2),b.bezierCurveTo(c.x+e/2,c.y+f/2,c.x+e/2,c.y-f/2,c.x,c.y-f/2),c._event&&z(this[a],b,c),B(this[a],b,c));return this};k.fn.drawPolygon=function(d){var a,b,c=new n(d),e=2*u/c.sides,f=u/c.sides,h=f+u/2,g=c.radius*G(e/2),j,k,l;
c.closed=m;c.projection&&(c.concavity=-c.projection);for(a=0;a<this.length;a+=1)if(b=q(this[a]))if(d=v(this[a],c,d,"drawPolygon"),c.visible){y(b,c);x(b,c,2*c.radius);b.beginPath();for(l=0;l<c.sides;l+=1)j=c.x+c.radius*G(h),k=c.y+c.radius*J(h),b.lineTo(j,k),c.concavity&&(j=c.x+(g+-g*c.concavity)*G(h+f),k=c.y+(g+-g*c.concavity)*J(h+f),b.lineTo(j,k)),h+=e;c._event&&z(this[a],b,c);B(this[a],b,c)}return this};k.fn.drawLine=function(d){var a,b,c=new n(d),e,f,h;for(a=0;a<this.length;a+=1)if(b=q(this[a]))if(d=
v(this[a],c,d,"drawLine"),c.visible){y(b,c);x(b,c,0);e=1;for(b.beginPath();m;)if(f=c["x"+e],h=c["y"+e],f!==p&&h!==p)b.lineTo(f+c.x,h+c.y),e+=1;else break;c._event&&z(this[a],b,c);B(this[a],b,c)}return this};k.fn.drawQuadratic=k.fn.drawQuad=function(d){var a,b,c=new n(d),e,f,h,g,j;for(a=0;a<this.length;a+=1)if(b=q(this[a]))if(d=v(this[a],c,d,"drawQuadratic"),c.visible){y(b,c);x(b,c,0);e=2;b.beginPath();for(b.moveTo(c.x1+c.x,c.y1+c.y);m;)if(f=c["x"+e],h=c["y"+e],g=c["cx"+(e-1)],j=c["cy"+(e-1)],f!==
p&&h!==p&&g!==p&&j!==p)b.quadraticCurveTo(g+c.x,j+c.y,f+c.x,h+c.y),e+=1;else break;c._event&&z(this[a],b,c);B(this[a],b,c)}return this};k.fn.drawBezier=function(d){var a,b,c=new n(d),e,f,h,g,j,k,l,r;for(a=0;a<this.length;a+=1)if(b=q(this[a]))if(d=v(this[a],c,d,"drawBezier"),c.visible){y(b,c);x(b,c,0);e=2;f=1;b.beginPath();for(b.moveTo(c.x1+c.x,c.y1+c.y);m;)if(h=c["x"+e],g=c["y"+e],j=c["cx"+f],k=c["cy"+f],l=c["cx"+(f+1)],r=c["cy"+(f+1)],h!==p&&g!==p&&j!==p&&k!==p&&l!==p&&r!==p)b.bezierCurveTo(j+c.x,
k+c.y,l+c.x,r+c.y,h+c.x,g+c.y),e+=1,f+=2;else break;c._event&&z(this[a],b,c);B(this[a],b,c)}return this};k.fn.drawVector=function(d){var a,b,c=new n(d),e,f,h,g,j;for(a=0;a<this.length;a+=1)if(b=q(this[a]))if(d=v(this[a],c,d,"drawVector"),c.visible){y(b,c);x(b,c,0);e=1;b.beginPath();g=c.x;j=c.y;for(b.moveTo(c.x,c.y);m;)if(f=c["a"+e],h=c["l"+e],f!==p&&h!==p)f=f*c._toRad-u/2,g+=h*F.cos(f),j+=h*F.sin(f),b.lineTo(g,j),e+=1;else break;c._event&&z(this[a],b,c);B(this[a],b,c)}return this};k.fn.drawGraph=
function(d){var a,b,c=new n(d),e,f,h,g,j,k;for(a=0;a<this.length;a+=1)if((b=q(this[a]))&&c.fn)if(d=v(this[a],c,d,"drawGraph"),c.visible){y(b,c);e=c.graph;f=c.domain;h=c.range;g=this[a].width;j=this[a].height;f===l&&(f=[l,l]);f[0]===l&&(f[0]=0);f[1]===l&&(f[1]=g);h===l&&(h=[l,l]);h[0]===l&&(h[0]=0);h[1]===l&&(h[1]=j);O(a,b,c,f,h);if("y"===e)for(e=f[0]-c.x;e<=f[1]-c.x;e+=1)g=c.fn(e,c),g===l?(P(this[a],b,c),O(a,b,c,f,h)):b.lineTo(e+c.x,g+c.y);else if("x"===e)for(g=h[0]-c.y;g<=h[1]-c.y;g+=1)e=c.fn(g,
c),e===l?(P(this[a],b,c),O(a,b,c,f,h)):b.lineTo(e+c.x,g+c.y);else if("r"===e)for(k=0;k<2*u;k+=u/180)j=c.fn(k,c),e=j*G(k),g=j*J(k),j===l?(P(this[a],b,c),O(b,c,f,h)):b.lineTo(e+c.x,g+c.y);P(this[a],b,c)}return this};k.fn.drawText=function(d){var a,b,c=new n(d),e,f,h,g;for(a=0;a<this.length;a+=1)if(k(this[a]),b=q(this[a]))if(d=v(this[a],c,d,"drawText"),c.visible){y(b,c);b.textBaseline=c.baseline;b.textAlign=c.align;ia(b,c);!a&&c.maxWidth!==l?e=ka(b,c):a||(e=String(c.text).split("\n"));a||ja(this[a],
b,c,e);x(b,c,c.width,c.height);a||(h=c.x,"left"===c.align?h-=c.width/2:"right"===c.align&&(h+=c.width/2));for(f=0;f<e.length;f+=1)b.shadowColor=c.shadowColor,g=c.y+f*c.height/e.length-(e.length-1)*c.height/e.length/2,b.fillText(e[f],h,g),"transparent"!==c.fillStyle&&(b.shadowColor="transparent"),b.strokeText(e[f],h,g);c._event?(b.beginPath(),b.rect(c.x-c.width/2,c.y-c.height/2,c.width,c.height),b.restore(),z(this[a],b,c),b.closePath(),R(b,s(this[a]),c)):b.restore()}t=c;return this};k.fn.measureText=
function(d){var a,b;a=d!==p&&("object"!==typeof d||d.layer)?this.getLayer(d):new n(d);if(d=q(this[0]))ia(d,a),b=ka(d,a),ja(this[0],d,a,b);return a};k.fn.drawImage=function(d){function a(a,c,e){return function(){0===c&&(g.width===l&&g.sWidth===l&&(g.width=g.sWidth=j.width),g.height===l&&g.sHeight===l&&(g.height=g.sHeight=j.height),d&&g.layer&&(d.width=g.width,d.height=g.height),g.sWidth!==l&&g.sHeight!==l&&g.sx!==l&&g.sy!==l?(g.width===l&&(g.width=g.sWidth),g.height===l&&(g.height=g.sHeight),g.cropFromCenter||
(g.sx+=g.sWidth/2,g.sy+=g.sHeight/2),g.sx+g.sWidth/2>j.width&&(g.sx=j.width-g.sWidth/2),0>g.sx-g.sWidth/2&&(g.sx=g.sWidth/2),0>g.sy-g.sHeight/2&&(g.sy=g.sHeight/2),g.sy+g.sHeight/2>j.height&&(g.sy=j.height-g.sHeight/2),y(e,g),x(e,g,g.width,g.height),e.drawImage(j,g.sx-g.sWidth/2,g.sy-g.sHeight/2,g.sWidth,g.sHeight,g.x-g.width/2,g.y-g.height/2,g.width,g.height)):(y(e,g),x(e,g,g.width,g.height),e.drawImage(j,g.x-g.width/2,g.y-g.height/2,g.width,g.height)));e.beginPath();e.rect(g.x-g.width/2,g.y-g.height/
2,g.width,g.height);g._event&&z(b[c],e,g);g._transformed&&e.restore();h=s(b[c]);e.closePath();e.stroke();Z(e,h,g);R(e,h,g);g.load&&g.load.call(a,d);g.layer&&g._next&&k(a).drawLayers({clear:r,resetFire:!0,index:g.index+1})}}var b=this,c,e,f,h,g=new n(d),j,m;c=g.source;m=c.getContext;c.src||m?j=c:c&&(t.source===c?j=t._source:(j=new X,j.src=c,t.source=c,t._source=j));for(e=0;e<b.length;e+=1)if(c=b[e],f=q(b[e]))d=v(b[e],g,d,"drawImage"),g.visible&&j&&(j.complete||m?a(c,e,f)():(k(j).bind("load",a(c,e,
f)),j.src=j.src));return b};k.fn.createPattern=k.fn.pattern=function(d){function a(){h=c.createPattern(f,e.repeat);e.load&&e.load.call(b[0],h)}var b=this,c,e=new n(d),f,h,g;(c=q(b[0]))?(g=e.source,I(g)?(f=Q.createElement("canvas"),f.width=e.width,f.height=e.height,d=q(f),g.call(f,d),a()):(d=g.getContext,g.src||d?f=g:(f=new X,f.src=g),f.complete||d?a():(k(f).bind("load",a),f.src=f.src))):h=l;return h};k.fn.createGradient=k.fn.gradient=function(d){var a;d=new n(d);var b=[],c,e,f,h,g,j,k;if(a=q(this[0])){d.x1=
d.x1||0;d.y1=d.y1||0;d.x2=d.x2||0;d.y2=d.y2||0;a=d.r1!==l||d.r2!==l?a.createRadialGradient(d.x1,d.y1,d.r1,d.x2,d.y2,d.r2):a.createLinearGradient(d.x1,d.y1,d.x2,d.y2);for(h=1;d["c"+h]!==p;h+=1)d["s"+h]!==p?b.push(d["s"+h]):b.push(l);c=b.length;b[0]===l&&(b[0]=0);b[c-1]===l&&(b[c-1]=1);for(h=0;h<c;h+=1){if(b[h]!==l){j=1;k=0;e=b[h];for(g=h+1;g<c;g+=1)if(b[g]!==l){f=b[g];break}else j+=1;e>f&&(b[g]=b[h])}else b[h]===l&&(k+=1,b[h]=e+k*((f-e)/j));a.addColorStop(b[h],d["c"+(h+1)])}}else a=l;return a};k.fn.setPixels=
function(d){var a,b,c,e=new n(d),f={},h,g,j,k;for(b=0;b<this.length;b+=1)if(a=this[b],c=q(a)){d=v(a,e,d,"setPixels");x(c,e,e.width,e.height);if(null===e.width||null===e.height)e.width=a.width,e.height=a.height,e.x=e.width/2,e.y=e.height/2;if(0!==e.width&&0!==e.height){h=c.getImageData(e.x-e.width/2,e.y-e.height/2,e.width,e.height);g=h.data;k=g.length;f=[];if(e.each)for(j=0;j<k;j+=4)f.r=g[j],f.g=g[j+1],f.b=g[j+2],f.a=g[j+3],e.each.call(a,f),g[j]=f.r,g[j+1]=f.g,g[j+2]=f.b,g[j+3]=f.a;c.putImageData(h,
e.x-e.width/2,e.y-e.height/2);c.restore()}}return this};k.fn.getCanvasImage=function(d,a){var b=this[0];a===p&&(a=1);return b&&b.toDataURL?b.toDataURL("image/"+d,a):l};k.support.canvas=Q.createElement("canvas").getContext!==p;w.defaults=M;w.detectEvents=z;w.closePath=B;k.jCanvas=w})(jQuery,document,Image,Math,parseFloat,!0,!1,null);
